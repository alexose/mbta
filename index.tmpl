<!DOCTYPE html>
<meta charset="utf-8">
<html>
<head>
  <!-- bower:css -->
  <!-- endbower -->
</head>
<body>
  <h1>MBTAVIZOMG</h1>
  <svg width="600" height="400" viewBox="0 0 100 100"></svg>
  <!-- bower:js -->
  <script src="client/bower_components/d3/d3.js"></script>
  <script src="client/bower_components/lodash/lodash.js"></script>
  <!-- endbower -->
  <script>
var data = {{data}};

var svg = d3.selectAll('svg'),
  stops = data.stops;

// Map colors
var colors = {
  'Green Line':  'green',
  'Red Line':    'red',
  'Orange Line': 'orange',
  'Blue Line':   'blue',
  'Mattapan Trolley': 'red'
};

var x = d3.scale.linear().domain([42.44, 42.25]).range([0, 100]),
  y = d3.scale.linear().domain([-71.21, -71.02]).range([0, 100]);

svg
  .selectAll('circle')
  .data(_.values(stops))
  .enter()
    .append('circle')
      .attr('cy', function(d){ return x(d.stop_lat); })
      .attr('cx', function(d){ return y(d.stop_lon); })
      .attr('r', 1)
      .style('fill', function(d){ return colors[d.route_name]; });

svg
  .selectAll('line')
  .data(data.segments)
  .enter()
    .append('line')
      .attr('y1', function(d){ return x(stops[d.start].stop_lat); })
      .attr('x1', function(d){ return y(stops[d.start].stop_lon); })
      .attr('y2', function(d){ return x(stops[d.end].stop_lat); })
      .attr('x2', function(d){ return y(stops[d.end].stop_lon); })
      .style('stroke', function(d){ return colors[stops[d.start].route_name]; });

// Set up web socket
var ws = new WebSocket('{{socket}}');

ws.onopen = function(){
  console.log('Socket opened.');
};

ws.onemessage = function(message){
  console.log(message);
};

  </script>
</body>
</html>
